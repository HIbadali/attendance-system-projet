<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Ã‰tudiant</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body{margin:0;display:flex;font-family:Arial;background:#f4f6f9;}
        .sidebar{width:260px;background:#6a0dad;height:100vh;color:white;padding:25px;}
        .sidebar h2{margin:0 0 20px;}
        .menu-item{padding:12px;border-radius:8px;margin-bottom:10px;cursor:pointer;}
        .menu-item:hover{background:rgba(255,255,255,0.25);}
        .content{padding:40px;width:100%;}
        .card{background:white;border-radius:10px;padding:18px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
        .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#ffd54f;color:#5d4037;font-size:12px;font-weight:bold;margin-left:8px;}
    </style>
</head>
<body>

<div class="sidebar">
    <h2>Ã‰tudiant</h2>
    <div class="menu-item" onclick="go('student_home.html')">ğŸ  Dashboard</div>
    <div class="menu-item" onclick="go('student_courses.html')">ğŸ“˜ Mes cours</div>
    <div class="menu-item" onclick="go('student_stats.html')">ğŸ“Š Statistiques</div>
    <div class="menu-item" onclick="go('student_schedule.html')">ğŸ“… Emploi du temps</div>
    <div class="menu-item" onclick="logout()">ğŸšª DÃ©connexion</div>
</div>

<div class="content">

    <h1>Dashboard</h1>

    <div class="card">
        <h3>RÃ©sumÃ©</h3>
        <p><b>Moyenne gÃ©nÃ©rale :</b> <span id="avg">0</span> / 20</p>
        <p><b>PrÃ©sence totale :</b> <span id="presence">0</span></p>
        <p><b>Absences totales :</b> <span id="absence">0</span></p>
        <p><b>Participations :</b> <span id="part">0</span></p>
    </div>

    <div class="card">
        <h3>Mes cours (avec Best Student)</h3>
        <div id="courseList">Chargement...</div>
    </div>
</div>

<script>
function go(p){ window.location.href = p; }

function logout(){
    $.get("../../../backend/api/auth/logout.php", ()=> {
        window.location.href = "../../login.html";
    });
}

// Charger stats globales
$.get("../../../backend/api/student/getMyStats.php", function(res){
    if(!res.success){ console.log(res); return; }
    const s = res.data;
    $("#avg").text(s.avg_note ?? 0);
    $("#presence").text(s.total_presence ?? 0);
    $("#absence").text(s.total_absence ?? 0);
    $("#part").text(s.total_participation ?? 0);
});

// Charger liste de cours + best
$.get("../../../backend/api/student/getMyCourses.php", function(res){
    if(!res.success){ $("#courseList").text("Erreur : "+res.message); return; }
    if(res.data.length === 0){ $("#courseList").text("Aucun cours."); return; }

    let html = "";
    res.data.forEach(c=>{
        html += `<p>
            <b>${c.code}</b> â€” ${c.title}
            ${c.best == 1 ? '<span class="badge">ğŸ… Best student</span>' : ''}
            <br>Note : ${c.note ?? 0}/20
        </p>`;
    });
    $("#courseList").html(html);
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cr√©er un cours - Admin</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#eef1f5;
    display:flex;
}
.sidebar{
    width:260px;
    background:#1565c0;
    height:100vh;
    padding:25px;
    color:white;
}
.sidebar h2{margin-top:0;}
.menu-item{
    padding:12px;
    border-radius:6px;
    cursor:pointer;
    margin-top:10px;
}
.menu-item:hover{background:rgba(255,255,255,0.2);}
.content{
    width:100%;
    padding:40px;
}
.box{
    width:450px;
    background:white;
    padding:25px;
    border-radius:10px;
    box-shadow:0 2px 12px rgba(0,0,0,0.15);
}
input, select{
    width:100%;
    padding:10px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #ccc;
}
.btn{
    background:#1565c0;
    padding:12px;
    width:100%;
    border:none;
    color:white;
    font-size:16px;
    border-radius:6px;
    cursor:pointer;
}
.btn:hover{background:#0b3a8c;}
</style>
</head>

<body>

<div class="sidebar">
    <h2>Admin</h2>

<div class="menu-item" onclick="go('admin_home.html')">üè† Dashboard</div>
<div class="menu-item" onclick="go('admin_courses.html')">üìò Gestion Cours</div>
    <div class="menu-item" onclick="go('../login.html')">üö™ D√©connexion</div>
</div>

<div class="content">
    <div class="box">
        <h2>Cr√©er un cours</h2>

        <label>Code du cours</label>
        <input type="text" id="course_code" placeholder="ex: INF101">

        <label>Nom du cours</label>
        <input type="text" id="course_title" placeholder="ex: Algorithmique">

        <label>Professeur responsable</label>
        <select id="prof_select"></select>

        <br><br>
        <button class="btn" onclick="save()">Enregistrer</button>

        <p id="msg" style="color:red;margin-top:10px;"></p>
    </div>
</div>

<script>
function go(p){window.location.href=p;}

// --- LOAD PROFESSEURS ---
$.get("../../../backend/api/admin/getProfessors.php", function(res){
    if(!res.success){
        $("#prof_select").append(`<option value="">Aucun professeur trouv√©</option>`);
        return;
    }

    res.data.forEach(p=>{
        $("#prof_select").append(`
            <option value="${p.id}">${p.last_name} ${p.first_name}</option>
        `);
    });
});

// --- SAVE ---
function save(){
    let code = $("#course_code").val().trim();
    let title = $("#course_title").val().trim();
    let prof  = $("#prof_select").val().trim();

    if(code === "" || title === "" || prof === ""){
        $("#msg").text("Veuillez remplir tous les champs.");
        return;
    }

    $("#msg").text("");

    $.ajax({
        url: "../../../backend/api/admin/addCourse.php",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({
            code: code,
            title: title,
            professor_id: prof
        }),
        success: function(res){
            if(res.success){
                alert("Cours cr√©√© !");
                window.location.href = "admin_courses.html";
            } else {
                $("#msg").text("Erreur : " + res.message);
            }
        },
        error: function(xhr){
            $("#msg").text("Erreur serveur.");
            console.log(xhr.responseText);
        }
    });
}
</script>

</body>
</html>

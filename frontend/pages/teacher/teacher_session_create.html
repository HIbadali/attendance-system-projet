<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Créer une session</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#eef0f3;padding:20px;}
.box{
    width:460px;margin:auto;background:white;border-radius:10px;
    padding:25px;box-shadow:0 2px 12px rgba(0,0,0,0.1);
}
h2{margin-top:0;}
input,select{
    width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;
}
.btn{
    padding:12px;width:100%;background:#1565c0;color:white;
    border:none;border-radius:6px;cursor:pointer;font-size:16px;
}
.btn:hover{background:#0c4296;}
.error{color:#c00;margin-top:8px;}
</style>
</head>

<body>

<div class="box">
    <h2>Créer une nouvelle session</h2>

    <label>Cours</label>
    <select id="course"></select>

    <label>Date</label>
    <input type="date" id="date">

    <button class="btn" onclick="save()">Valider</button>

    <div id="msg" class="error"></div>
</div>

<script>
// Charger la liste des cours du professeur
$.get("../../../backend/api/professor/getMyCourses.php", function(res){
    if(!res.success){
        $("#msg").text("Impossible de charger les cours.");
        return;
    }
    if(res.data.length === 0){
        $("#course").append(`<option value="">Aucun cours trouvé</option>`);
        return;
    }
    res.data.forEach(c=>{
        $("#course").append(`<option value="${c.id}">${c.code} — ${c.title}</option>`);
    });
});

function save(){
    const course_id = $("#course").val();
    const date      = $("#date").val();

    if(!course_id || !date){
        $("#msg").text("Veuillez choisir un cours et une date.");
        return;
    }

    $("#msg").text("");

    $.ajax({
        url: "../../../backend/api/professor/addSession.php",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({
            course_id: course_id,
            date: date
        }),
        success: function(res){
            if(!res.success){
                $("#msg").text(res.message || "Erreur lors de la création.");
                return;
            }
            alert("Session créée avec succès !");
            window.location.href = "teacher_sessions.html";
        },
        error: function(xhr){
            console.log(xhr.responseText);
            $("#msg").text("Erreur serveur.");
        }
    });
}
</script>

</body>
</html>

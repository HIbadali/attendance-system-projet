<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Prise de pr√©sence</title>

<!-- jQuery FIX√â ICI üëá -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f3f5f8;padding:20px;}
.box{width:520px;margin:auto;background:white;padding:25px;border-radius:10px;
     box-shadow:0 2px 10px rgba(0,0,0,0.15);}
.student{
    margin:10px 0;padding:12px;border-radius:8px;background:#eef3fb;
    display:flex;justify-content:space-between;align-items:center;
}
.btn{
    padding:10px;background:#1565c0;color:white;border:none;
    border-radius:6px;cursor:pointer;font-size:15px;width:100%;
}
.btn:hover{background:#0c4296;}
select{padding:8px;border-radius:6px;font-size:14px;}
</style>
</head>

<body>

<div class="box">
    <h2>Prise de pr√©sence</h2>

    <!-- LISTE √âTUDIANTS -->
    <div id="student-list">Chargement...</div>

    <br>
    <button class="btn" onclick="save()">Valider</button>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const session_id = params.get("session");

// Charger liste √©tudiants
function load(){
    $.get("../../../backend/api/professor/getStudentsForSession.php",
    {session_id: session_id},
    function(res){

        if(!res.success){
            $("#student-list").html("Erreur : "+res.message);
            return;
        }

        if(res.data.length === 0){
            $("#student-list").html("Aucun √©tudiant assign√©.");
            return;
        }

        let html = "";
        res.data.forEach(s=>{
            html += `
            <div class="student">
                <b>${s.last_name} ${s.first_name}</b>
                <select id="s${s.id}">
                    <option value="present">Pr√©sent</option>
                    <option value="absent">Absent</option>
                </select>
            </div>`;
        });

        $("#student-list").html(html);
    });
}

// Sauvegarder pr√©sence
function save(){
    let data = [];

    $(".student select").each(function(){
        let id = $(this).attr("id").substring(1);
        let val = $(this).val();
        data.push({student_id: id, status: val});
    });

    $.ajax({
        url: "../../../backend/api/professor/saveAttendance.php",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({
            session_id: session_id,
            students: data
        }),
        success: d=>{
            alert("Pr√©sence enregistr√©e !");
            window.location.href = "teacher_sessions.html";
        }
    });
}

load();
</script>

</body>
</html>
